<!doctype html>

<head>
    <title>Where is Erik?</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css"
      integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
      crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js"
      integrity="sha512-tAGcCfR4Sc5ZP5ZoVz0quoZDYX5aCtEm/eu1KhSLj2c9eFrylXZknQYmxUssFaVJKvvc0dJQixhGjG2yXWiV9Q=="
      crossorigin=""></script>
</head>

<div id="map"></div>

<script type="text/javascript">
 const map = L.map('map').setView([34, -118], 10);

 L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
  .addTo(map);

 fetch('/where')
   .then(data => data.json())
   .then(json => json.where)
   .then(points => {
     if (points.length === 0) return;

     const polyline = L.polyline(points.map(it => [it.lat, it.lng])).addTo(map);
     map.fitBounds(polyline.getBounds());

     points.forEach(point => {
       L.marker([point.lat, point.lng])
        .bindPopup(`<p>${point.comment}</p><p>${point.ts}</p>`)
        .addTo(map);
     });
   })
   .catch(err => { alert(`Failed to get coordinates: ${err}`); });
</script>

<style>
 body { padding: 0; margin: 0; }
 #map { width: 100vw; height: 100vh;}
</style>
